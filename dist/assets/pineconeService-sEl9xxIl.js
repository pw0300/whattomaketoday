import{Pinecone as P}from"@pinecone-database/pinecone";import{g as h}from"./Dashboard-J6Xxs6vu.js";import"./index-1Zneb5no.js";import"./vendor-ai-CPrgQTwB.js";import"./firebaseService-C9yZOPCO.js";import"./vendor-db-CpiILupR.js";import"./clock-pZb8NoLU.js";import"./zap-BcV8zEwV.js";import"./share-2-CI2VHR69.js";import"./arrow-left-Cj57b7l6.js";import"./SEO-BL8M3-1-.js";var m={};const I="tadkasync-main";class b{constructor(){this.pc=null,this.indexName=I,this.isInitialized=!1;const t=typeof process<"u"?m==null?void 0:m.PINECONE_API_KEY:void 0;if(t)try{this.pc=new P({apiKey:t}),this.isInitialized=!0,console.log("[Pinecone] Initialized with server-side key.")}catch(r){console.warn("[Pinecone] Failed to initialize Pinecone client:",r),this.isInitialized=!1}else console.warn("[Pinecone] API Key not found (expected in browser). Vector search disabled client-side.")}getClient(){return this.pc}getIndex(){return this.pc?this.pc.index(this.indexName):null}async upsert(t,r="default"){if(this.pc)try{const n=this.getIndex();if(!n)return;const s=(await Promise.all(t.map(async e=>{const o=await h(e.text);return o?{id:e.id,values:o,metadata:{...e.metadata,text:e.text}}:null}))).filter(e=>e!==null);s.length>0&&(await n.namespace(r).upsert(s),console.log(`[Pinecone] Upserted ${s.length} records to namespace '${r}'.`))}catch(n){console.error("[Pinecone] Upsert Error:",n)}}async search(t,r="default",n=5){if(!this.pc)return[];try{const i=this.getIndex();if(!i)return[];const s=await h(t);return s?(await i.namespace(r).query({vector:s,topK:n,includeMetadata:!0})).matches||[]:[]}catch(i){return console.error("[Pinecone] Search Error:",i),[]}}async hybridSearch(t,r="default",n={}){if(!this.pc)return[];const{topK:i=5,userInteractionCount:s=0}=n,e=n.alpha??Math.max(.3,.7-s*.02);try{const o=this.getIndex();if(!o)return[];const p=await h(t);if(!p)return[];const f=(await o.namespace(r).query({vector:p,topK:i*2,includeMetadata:!0})).matches||[];if(f.length===0)return[];const g=t.toLowerCase().split(/\s+/).filter(c=>c.length>2),d=f.map(c=>{const l=c.score||0;let u=0;const a=c.metadata||{},y=[a.text||"",a.name||"",a.cuisine||"",Array.isArray(a.tags)?a.tags.join(" "):a.tags||""].join(" ").toLowerCase();g.forEach(w=>{y.includes(w)&&(u+=1/g.length)});const x=e*u+(1-e)*l;return{...c,score:x,_semanticScore:l,_bm25Score:u}});return d.sort((c,l)=>(l.score||0)-(c.score||0)),console.log(`[Pinecone] Hybrid search (alpha=${e.toFixed(2)}): ${d.length} results`),d.slice(0,i)}catch(o){return console.error("[Pinecone] Hybrid Search Error:",o),[]}}isAvailable(){return this.isInitialized&&this.pc!==null}}const k=new b;export{k as pineconeService};
