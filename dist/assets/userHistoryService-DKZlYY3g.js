import{d as n}from"./firebaseService-C9yZOPCO.js";import{d as o,s as m,j as d,f as p}from"./vendor-db-CpiILupR.js";import{contextManager as w}from"./contextManagerService-B6eCq0LR.js";import"./index-1Zneb5no.js";import"./vendor-ai-CPrgQTwB.js";import"./Dashboard-J6Xxs6vu.js";import"./clock-pZb8NoLU.js";import"./zap-BcV8zEwV.js";import"./share-2-CI2VHR69.js";import"./arrow-left-Cj57b7l6.js";import"./SEO-BL8M3-1-.js";const c="user_histories",L=async(t,e)=>{if(!(!n||!t))try{const s=o(n,c,t);await m(s,{shownDishNames:d(e.name),lastUpdated:new Date},{merge:!0}),console.log(`[History] Tracked shown dish: ${e.name}`)}catch(s){console.warn("[History] Failed to track shown dish:",s)}},O=async(t,e)=>{if(!(!n||!t))try{const s=o(n,c,t);await m(s,{likedDishes:d({name:e.name,cuisine:e.cuisine,tags:e.tags||[],timestamp:new Date}),lastUpdated:new Date},{merge:!0}),console.log(`[History] Tracked liked dish: ${e.name}`),w.recordEvent({type:"swipe_right",dish:e,timestamp:Date.now()})}catch(s){console.warn("[History] Failed to track liked dish:",s)}},T=async(t,e)=>{if(!(!n||!t))try{const s=o(n,c,t);await m(s,{dislikedDishes:d({name:e.name,cuisine:e.cuisine,tags:e.tags||[],timestamp:new Date}),lastUpdated:new Date},{merge:!0}),console.log(`[History] Tracked disliked dish: ${e.name}`),w.recordEvent({type:"swipe_left",dish:e,timestamp:Date.now()})}catch(s){console.warn("[History] Failed to track disliked dish:",s)}},j=async t=>{if(!n||!t)return[];try{const e=o(n,c,t),s=await p(e);return s.exists()?s.data().shownDishNames||[]:[]}catch(e){return console.warn("[History] Failed to get shown dishes:",e),[]}},F=async t=>{if(!n||!t)return null;try{const e=o(n,c,t),s=await p(e);return s.exists()?s.data():null}catch(e){return console.warn("[History] Failed to get user history:",e),null}},$=t=>{if(!t||!t.likedDishes||t.likedDishes.length===0)return"";const e={};t.likedDishes.forEach(i=>{e[i.cuisine]=(e[i.cuisine]||0)+1});const s=Object.entries(e).sort(([,i],[,r])=>r-i).slice(0,3).map(([i])=>i),a={};t.likedDishes.forEach(i=>{var r;(r=i.tags)==null||r.forEach(h=>{a[h]=(a[h]||0)+1})});const u=Object.entries(a).sort(([,i],[,r])=>r-i).slice(0,5).map(([i])=>i);let l="";if(s.length>0&&(l+=`
USER LOVES: ${s.join(", ")} cuisine.`),u.length>0&&(l+=`
PREFERRED QUALITIES: ${u.join(", ")}.`),t.dislikedDishes&&t.dislikedDishes.length>0){const i=[...new Set(t.dislikedDishes.map(r=>r.cuisine))].slice(0,3);i.length>0&&(l+=`
AVOID: ${i.join(", ")} dishes.`)}return l},_=(t,e)=>{const s=new Set(e.map(a=>a.toLowerCase().trim()));return t.filter(a=>!s.has(a.name.toLowerCase().trim()))};export{$ as analyzeUserPreferences,_ as filterUnseenDishes,j as getShownDishNames,F as getUserHistory,T as trackDislikedDish,O as trackLikedDish,L as trackShownDish};
