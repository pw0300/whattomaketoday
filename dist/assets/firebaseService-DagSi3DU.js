import{i as m,b as h,e as A,d as g,s as S,f as D,G as b,h as w,o as R}from"./vendor-db-D82zeHBC.js";const I={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyDCjpuA6Fsi1oHQqdOpwgwqnfzFPBn6VD4",VITE_FIREBASE_APP_ID:"1:123491617008:web:dbfdab6a470202cbea5a35",VITE_FIREBASE_AUTH_DOMAIN:"whattoeat-91e87.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-CL7K4RB8TN",VITE_FIREBASE_MESSAGING_SENDER_ID:"123491617008",VITE_FIREBASE_PROJECT_ID:"whattoeat-91e87",VITE_FIREBASE_STORAGE_BUCKET:"whattoeat-91e87.firebasestorage.app"};var c={};const i=e=>{let t;return typeof process<"u"&&c&&(t=c[e]),!t&&typeof import.meta<"u"&&I&&(t=I[e]),t||""},p=(e,t)=>i(e)||t,v=()=>{let e;return typeof process<"u"&&c&&(e=c.GEMINI_API_KEY||c.VITE_GEMINI_API_KEY),e||""},s={firebase:{apiKey:i("VITE_FIREBASE_API_KEY"),authDomain:i("VITE_FIREBASE_AUTH_DOMAIN"),projectId:i("VITE_FIREBASE_PROJECT_ID"),storageBucket:i("VITE_FIREBASE_STORAGE_BUCKET"),messagingSenderId:i("VITE_FIREBASE_MESSAGING_SENDER_ID"),appId:i("VITE_FIREBASE_APP_ID"),measurementId:i("VITE_FIREBASE_MEASUREMENT_ID")},gemini:{apiKey:v(),defaultModel:p("GEMINI_MODEL","gemini-2.0-flash")},pinecone:{apiKey:p("PINECONE_API_KEY",""),indexHost:p("PINECONE_INDEX_HOST","")}},T=()=>{const e=Object.entries(s.firebase).filter(([t,r])=>!r);return e.length>0?(console.error("Missing Firebase Configuration:",e.map(([t])=>t).join(", ")),!1):!0};T()||console.error("[lib/firebase] Missing required environment variables");const P={apiKey:s.firebase.apiKey,authDomain:s.firebase.authDomain,projectId:s.firebase.projectId,storageBucket:s.firebase.storageBucket,messagingSenderId:s.firebase.messagingSenderId,appId:s.firebase.appId};let d,o,l;try{d=m(P),o=h(d),l=A(d)}catch(e){throw console.error("[lib/firebase] Initialization failed:",e),e}const k=Object.freeze(Object.defineProperty({__proto__:null,get app(){return d},get auth(){return o},get db(){return l}},Symbol.toStringTag,{value:"Module"})),a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));function F(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}let E;const U=new Uint8Array(16);function B(){if(!E){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");E=crypto.getRandomValues.bind(crypto)}return E(U)}const C=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),f={randomUUID:C};function _(e,t,r){var u;if(f.randomUUID&&!e)return f.randomUUID();e=e||{};const n=e.random??((u=e.rng)==null?void 0:u.call(e))??B();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,F(n)}const N=e=>e?Array.from(new Set(e.map(r=>r.trim()).filter(r=>r.length>0))).map(r=>({id:_(),name:r,quantityType:"binary",quantityLevel:1,category:"Uncategorized",addedAt:Date.now()})):[],O=(e,t)=>{const r=e.findIndex(n=>n.name.toLowerCase()===t.name.toLowerCase());if(r>=0){const n=[...e];return n[r]={...n[r],quantityLevel:t.quantityLevel||3,addedAt:Date.now(),...t,id:n[r].id},n}else{const n={id:_(),quantityType:"binary",quantityLevel:1,category:"Uncategorized",addedAt:Date.now(),...t};return[...e,n]}},G=(e,t)=>e.filter(r=>r.id!==t),y=e=>{if(e==null)return null;if(typeof e!="object"||e instanceof Date)return e;if(Array.isArray(e))return e.map(r=>y(r)).filter(r=>r!==void 0);const t={};for(const r in e){const n=e[r];n!==void 0&&(t[r]=y(n))}return t},V=new b,K=async()=>{if(!o)throw alert("Authentication unavailable: Missing Configuration"),new Error("Missing Config");try{const t=(await w(o,V)).user;return{uid:t.uid,name:t.displayName||"Home Chef",photo:t.photoURL||`https://api.dicebear.com/7.x/avataaars/svg?seed=${t.uid}`}}catch(e){throw console.error("Firebase Auth Error:",e),e.code==="auth/popup-closed-by-user"?console.warn("User closed popup before finishing sign in."):e.code==="auth/network-request-failed"?alert("Network Error: Please check your connection."):alert(`Login Failed: ${e.message}`),e}},q=()=>o==null?void 0:o.signOut(),x=e=>o?R(o,e):()=>{},L=async(e,t)=>{if(e)try{const r=g(l,"users",e),n=y(t);await S(r,n,{merge:!0}),console.debug(`[Cloud Sync] State persisted for UID: ${e}`)}catch(r){console.error("Firestore Sync Error:",r)}},z=async e=>{if(!e)return null;try{const t=g(l,"users",e),r=await D(t);if(r.exists()){const n=r.data();return Array.isArray(n.pantryStock)&&n.pantryStock.length>0&&typeof n.pantryStock[0]=="string"&&(console.info("Migrating legacy pantry data..."),n.pantryStock=N(n.pantryStock)),n}return null}catch(t){return console.error("Firestore Fetch Error:",t),null}},H=(e,t)=>{if(!t)return e;const r=[...t.approvedDishes];return e.approvedDishes.forEach(n=>{r.find(u=>u.id===n.id)||r.push(n)}),{profile:t.profile||e.profile,approvedDishes:r,weeklyPlan:t.weeklyPlan&&t.weeklyPlan.length>0?t.weeklyPlan:e.weeklyPlan,pantryStock:[...t.pantryStock||[],...e.pantryStock||[]]}};export{G as a,O as b,L as c,l as d,s as e,K as f,z as g,k as h,q as l,x as o,H as r,y as s};
