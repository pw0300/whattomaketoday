import{i as _,b as m,e as h,d as I,s as A,f as S,G as D,h as w,o as R}from"./vendor-db-CpiILupR.js";const y={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyDCjpuA6Fsi1oHQqdOpwgwqnfzFPBn6VD4",VITE_FIREBASE_APP_ID:"1:123491617008:web:dbfdab6a470202cbea5a35",VITE_FIREBASE_AUTH_DOMAIN:"whattoeat-91e87.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-CL7K4RB8TN",VITE_FIREBASE_MESSAGING_SENDER_ID:"123491617008",VITE_FIREBASE_PROJECT_ID:"whattoeat-91e87",VITE_FIREBASE_STORAGE_BUCKET:"whattoeat-91e87.firebasestorage.app"};var c={};const o=e=>{let t;return typeof process<"u"&&c&&(t=c[e]),!t&&typeof import.meta<"u"&&y&&(t=y[e]),t||""},b=(e,t)=>o(e)||t,v=()=>{let e;return typeof process<"u"&&c&&(e=c.GEMINI_API_KEY||c.VITE_GEMINI_API_KEY),e||""},s={firebase:{apiKey:o("VITE_FIREBASE_API_KEY"),authDomain:o("VITE_FIREBASE_AUTH_DOMAIN"),projectId:o("VITE_FIREBASE_PROJECT_ID"),storageBucket:o("VITE_FIREBASE_STORAGE_BUCKET"),messagingSenderId:o("VITE_FIREBASE_MESSAGING_SENDER_ID"),appId:o("VITE_FIREBASE_APP_ID"),measurementId:o("VITE_FIREBASE_MEASUREMENT_ID")},gemini:{apiKey:v(),defaultModel:b("GEMINI_MODEL","gemini-2.0-flash")}},T=()=>{const e=Object.entries(s.firebase).filter(([t,n])=>!n);return e.length>0?(console.error("Missing Firebase Configuration:",e.map(([t])=>t).join(", ")),!1):!0};T()||console.error("[lib/firebase] Missing required environment variables");const F={apiKey:s.firebase.apiKey,authDomain:s.firebase.authDomain,projectId:s.firebase.projectId,storageBucket:s.firebase.storageBucket,messagingSenderId:s.firebase.messagingSenderId,appId:s.firebase.appId};let u,i,E;try{u=_(F),i=m(u),E=h(u)}catch(e){throw console.error("[lib/firebase] Initialization failed:",e),e}const a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));function U(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}let l;const P=new Uint8Array(16);function B(){if(!l){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");l=crypto.getRandomValues.bind(crypto)}return l(P)}const V=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),f={randomUUID:V};function g(e,t,n){var d;if(f.randomUUID&&!e)return f.randomUUID();e=e||{};const r=e.random??((d=e.rng)==null?void 0:d.call(e))??B();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,U(r)}const C=e=>e?Array.from(new Set(e.map(n=>n.trim()).filter(n=>n.length>0))).map(n=>({id:g(),name:n,quantityType:"binary",quantityLevel:1,category:"Uncategorized",addedAt:Date.now()})):[],N=(e,t)=>{const n=e.findIndex(r=>r.name.toLowerCase()===t.name.toLowerCase());if(n>=0){const r=[...e];return r[n]={...r[n],quantityLevel:t.quantityLevel||3,addedAt:Date.now(),...t,id:r[n].id},r}else{const r={id:g(),quantityType:"binary",quantityLevel:1,category:"Uncategorized",addedAt:Date.now(),...t};return[...e,r]}},G=(e,t)=>e.filter(n=>n.id!==t),p=e=>{if(e==null)return null;if(typeof e!="object"||e instanceof Date)return e;if(Array.isArray(e))return e.map(n=>p(n)).filter(n=>n!==void 0);const t={};for(const n in e){const r=e[n];r!==void 0&&(t[n]=p(r))}return t},M=new D,q=async()=>{if(!i)throw alert("Authentication unavailable: Missing Configuration"),new Error("Missing Config");try{const t=(await w(i,M)).user;return{uid:t.uid,name:t.displayName||"Home Chef",photo:t.photoURL||`https://api.dicebear.com/7.x/avataaars/svg?seed=${t.uid}`}}catch(e){throw console.error("Firebase Auth Error:",e),e.code==="auth/popup-closed-by-user"?console.warn("User closed popup before finishing sign in."):e.code==="auth/network-request-failed"?alert("Network Error: Please check your connection."):alert(`Login Failed: ${e.message}`),e}},O=()=>i==null?void 0:i.signOut(),x=e=>i?R(i,e):()=>{},K=async(e,t)=>{if(e)try{const n=I(E,"users",e),r=p(t);await A(n,r,{merge:!0}),console.debug(`[Cloud Sync] State persisted for UID: ${e}`)}catch(n){console.error("Firestore Sync Error:",n)}},L=async e=>{if(!e)return null;try{const t=I(E,"users",e),n=await S(t);if(n.exists()){const r=n.data();return Array.isArray(r.pantryStock)&&r.pantryStock.length>0&&typeof r.pantryStock[0]=="string"&&(console.info("Migrating legacy pantry data..."),r.pantryStock=C(r.pantryStock)),r}return null}catch(t){return console.error("Firestore Fetch Error:",t),null}},z=(e,t)=>{if(!t)return e;const n=[...t.approvedDishes];return e.approvedDishes.forEach(r=>{n.find(d=>d.id===r.id)||n.push(r)}),{profile:t.profile||e.profile,approvedDishes:n,weeklyPlan:t.weeklyPlan&&t.weeklyPlan.length>0?t.weeklyPlan:e.weeklyPlan,pantryStock:[...t.pantryStock||[],...e.pantryStock||[]]}};export{G as a,N as b,K as c,E as d,s as e,q as f,L as g,O as l,x as o,z as r,p as s};
