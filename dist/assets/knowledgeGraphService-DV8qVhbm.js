import{_ as l}from"./index-1Zneb5no.js";import{A as o}from"./Dashboard-J6Xxs6vu.js";import"./vendor-ai-CPrgQTwB.js";import"./firebaseService-C9yZOPCO.js";import"./vendor-db-CpiILupR.js";import"./clock-pZb8NoLU.js";import"./zap-BcV8zEwV.js";import"./share-2-CI2VHR69.js";import"./arrow-left-Cj57b7l6.js";import"./SEO-BL8M3-1-.js";class c{constructor(){this.ingredients={},this.dishTemplates={}}async ensureLoaded(){if(Object.keys(this.ingredients).length>0)return;console.log("[KG] Dynamically loading Knowledge Graph...");const t=await l(()=>import("./ingredients_master_list-DZgj_F0b.js"),[]);this.ingredients=t.ingredients,this.dishTemplates=t.dishTemplates}normalizeKey(t){return t.toLowerCase().trim().replace(/\s+/g,"-")}async validateIngredient(t){return await this.ensureLoaded(),this.normalizeKey(t)in this.ingredients}async getIngredient(t){await this.ensureLoaded();const e=this.normalizeKey(t);return this.ingredients[e]||null}async getSubstitutes(t){const e=await this.getIngredient(t);return e?e.substitutes.map(n=>{const i=this.ingredients[n];return i?i.displayName:n}):[]}async hasAllergen(t,e){const n=await this.getIngredient(t);return n?n.allergens.includes(e):!1}async getSafeIngredients(t){return await this.ensureLoaded(),Object.values(this.ingredients).filter(e=>!e.allergens.some(n=>t.includes(n)))}async suggestDishesFromPantry(t){await this.ensureLoaded();const e=t.map(n=>this.normalizeKey(n));return Object.values(this.dishTemplates).filter(n=>n.essentialIngredients.filter(s=>e.includes(s)).length/n.essentialIngredients.length>=.7)}async getMissingIngredients(t,e){await this.ensureLoaded();const n=this.dishTemplates[t];if(!n)return[];const i=e.map(s=>this.normalizeKey(s));return n.essentialIngredients.filter(s=>!i.includes(s)).map(s=>{var r;return((r=this.ingredients[s])==null?void 0:r.displayName)||s})}logUsage(t,e){console.log(`[KG Telemetry] ${t}${e?` - ${e}`:""}`)}learnFromDish(t){t.ingredients.forEach(e=>{if(!this.validateIngredient(e.name)){const n=[];e.category==="Dairy"&&n.push(o.Dairy),e.category==="Protein"&&(e.name.toLowerCase().includes("nut")||e.name.toLowerCase().includes("cashew"))&&n.push(o.Nuts),console.log(`[KG Learning] Learned new ingredient from Recipe: ${e.name} (${e.category})`),this.ingredients[this.normalizeKey(e.name)]={displayName:e.name,category:e.category,tier:"Exotic",allergens:n,seasonality:"Year-round",substitutes:[],commonIn:[],nutritionProfile:"unknown"}}})}async isDishContextSafe(t,e){for(const n of t.ingredients){const i=await this.getIngredient(n.name);if(i){const s=i.allergens.filter(r=>e.includes(r));if(s.length>0)return console.log(`[KG Guard] Unsafe Dish: Ingredient '${n.name}' contains ${s.join(", ")}`),!1}}return!0}async suggestDishes(t){return await this.ensureLoaded(),Object.values(this.dishTemplates).filter(e=>{if(t.dietaryPreference!=="Any"){if(t.dietaryPreference==="Vegetarian"&&!e.dietaryTags.includes("Vegetarian")&&!e.dietaryTags.includes("Vegan")||t.dietaryPreference==="Vegan"&&!e.dietaryTags.includes("Vegan"))return!1;t.dietaryPreference}return!(e.essentialIngredients.some(i=>{const s=this.normalizeKey(i),r=this.ingredients[s];return r?r.allergens.some(a=>t.allergens.includes(a)):!1})||t.cuisines&&t.cuisines.length>0&&!t.cuisines.some(s=>{var r,a;return((r=e.cuisine)==null?void 0:r.toLowerCase().includes(s.toLowerCase()))||s.toLowerCase().includes(((a=e.cuisine)==null?void 0:a.toLowerCase())||"")}))})}async getRelevantSafetyContext(t,e){await this.ensureLoaded();const n=[],i=t.map(s=>s.toLowerCase());return i.length>0&&Object.values(this.ingredients).forEach(s=>{const r=s.allergens.filter(a=>i.includes(a.toLowerCase()));if(r.length>0){const a=s.substitutes.join(", ")||"Avoid";n.push(`- ${s.displayName}: Contains ${r.join(", ")}. Substitute with: ${a}`)}}),e.some(s=>s.includes("Diabetes"))&&(n.push("- General Diabetes Rule: Minimize sugar, white rice, potato. Prioritize fiber/protein."),Object.values(this.ingredients).forEach(s=>{s.glycemicIndex==="High"&&n.push(`- ${s.displayName}: High GI. Use sparingly.`)})),e.some(s=>s.includes("Hypertension"))&&n.push("- General Hypertension Rule: Low sodium. Minimize salt, pickles, processed sauces."),n.length>0?`RELEVANT INGREDIENT RULES:
`+n.join(`
`):"No specific ingredient constraints found in KG."}}const b=new c;export{b as knowledgeGraph};
