import{r as g,j as e}from"./index-COKk1VIN.js";import{w as p,h as v,d as h}from"./firebaseService-OWFze-Db.js";const C=()=>{const[u,f]=g.useState(!1),[i,n]=g.useState({total:0,success:0,errors:0}),[b,x]=g.useState([]),j=r=>{var l;const s=(l=r.target.files)==null?void 0:l[0];if(!s)return;const a=new FileReader;a.onload=async o=>{var d;try{const t=JSON.parse((d=o.target)==null?void 0:d.result);Array.isArray(t)?await y(t):alert("Invalid JSON: Expected an array of dishes.")}catch(t){console.error("Parse Error",t),alert("Failed to parse JSON file.")}},a.readAsText(s)},y=async r=>{f(!0),x([]),n({total:r.length,success:0,errors:0});const s=100;let a=p(h),l=0,o=0,d=0;for(const t of r)try{if(!t.name)continue;const c=t.id||crypto.randomUUID(),N=v(h,"cached_dishes",c);a.set(N,{...t,id:c,isViral:!0,ingestedAt:new Date().toISOString()}),l++,l%s===0&&(await a.commit(),a=p(h),o+=s,n(m=>({...m,success:o})),x(m=>[...m.slice(-4),`Committed batch of ${s}...`]))}catch(c){console.error("Skipping dish",t.name,c),d++}l%s!==0&&(await a.commit(),o+=l%s),n({total:r.length,success:o,errors:d}),f(!1),x(t=>[...t,"Seeding Complete!"])};return e.jsxs("div",{className:"p-6 bg-gray-900 text-white rounded-lg shadow-xl max-w-2xl mx-auto my-10 border border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-green-400 to-blue-500 mb-4",children:"Viral Recipe Seeder"}),e.jsxs("p",{className:"text-gray-400 mb-6",children:["Upload the ",e.jsx("code",{children:"master_recipe_db.json"})," file generated by the ingestion script to populate the Firestore database."]}),e.jsx("div",{className:"mb-6",children:e.jsx("input",{type:"file",accept:".json",onChange:j,disabled:u,className:`block w-full text-sm text-gray-400\r
                        file:mr-4 file:py-2 file:px-4\r
                        file:rounded-full file:border-0\r
                        file:text-sm file:font-semibold\r
                        file:bg-blue-600 file:text-white\r
                        hover:file:bg-blue-700\r
                        cursor-pointer`})}),u&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${i.success/i.total*100}%`}})})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6 text-center",children:[e.jsxs("div",{className:"p-3 bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total Recipes"}),e.jsx("div",{className:"text-xl font-bold",children:i.total})]}),e.jsxs("div",{className:"p-3 bg-gray-800 rounded-lg border border-green-900/30",children:[e.jsx("div",{className:"text-sm text-green-500",children:"Success"}),e.jsx("div",{className:"text-xl font-bold text-green-400",children:i.success})]}),e.jsxs("div",{className:"p-3 bg-gray-800 rounded-lg border border-red-900/30",children:[e.jsx("div",{className:"text-sm text-red-500",children:"Errors"}),e.jsx("div",{className:"text-xl font-bold text-red-400",children:i.errors})]})]}),e.jsxs("div",{className:"font-mono text-xs text-gray-500 bg-black/50 p-4 rounded h-32 overflow-y-auto",children:[b.map((r,s)=>e.jsx("div",{children:r},s)),b.length===0&&e.jsx("span",{className:"opacity-50",children:"Waiting for upload..."})]})]})};export{C as DataSeeder};
