import{_ as x}from"./index-BHEJfJXL.js";import{e as S}from"./firebaseService-DagSi3DU.js";import{g as p}from"./Dashboard-HUkIc70m.js";import"./vendor-ai-BIm9I_gW.js";import"./vendor-db-D82zeHBC.js";import"./clock-BXxcq1b-.js";import"./zap-CEaXJmts.js";import"./share-2-7Wy88bAL.js";import"./arrow-left-ksOdGg8V.js";import"./SEO-CJSjSUQt.js";const v="tadkasync-main";class I{constructor(){this.pc=null,this.indexName=v,this.isInitialized=!1,this.init()}async init(){if(typeof window<"u")return;const o=S.pinecone.apiKey;if(o)try{const{Pinecone:r}=await x(async()=>{const{Pinecone:t}=await import("./mockPinecone-Dg0jCDFg.js");return{Pinecone:t}},[]);this.pc=new r({apiKey:o}),this.isInitialized=!0,console.log("[Pinecone] Service Initialized.")}catch(r){console.warn("[Pinecone] Initialization failed:",r)}else console.warn("[Pinecone] Missing API Key. Vector features disabled.")}getClient(){return this.pc}getIndex(){return this.pc?this.pc.index(this.indexName):null}async upsert(o,r="default"){if(this.pc)try{const t=this.getIndex();if(!t)return;const i=(await Promise.all(o.map(async e=>{const s=await p(e.text);return s?{id:e.id,values:s,metadata:{...e.metadata,text:e.text}}:null}))).filter(e=>e!==null);i.length>0&&(await t.namespace(r).upsert(i),console.log(`[Pinecone] Upserted ${i.length} records to namespace '${r}'.`))}catch(t){console.error("[Pinecone] Upsert Error:",t)}}async search(o,r="default",t=5){if(this.pc)try{const n=this.getIndex();if(!n)return[];const i=await p(o);return i?(await n.namespace(r).query({vector:i,topK:t,includeMetadata:!0})).matches||[]:[]}catch(n){return console.error("[Pinecone] SDK Search Error:",n),[]}try{const n=typeof window<"u"&&window.location.hostname==="localhost",i="whattoeat-91e87",e="us-central1",s=n?`http://127.0.0.1:5001/${i}/${e}/vectorSearch`:`https://${e}-${i}.cloudfunctions.net/vectorSearch`;console.debug(`[Pinecone] Proxying search to: ${s}`);const a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o,namespace:r,topK:t})});return a.ok?(await a.json()).matches||[]:(console.warn(`[Pinecone] Proxy Error ${a.status}: ${await a.text()}`),[])}catch(n){return console.error("[Pinecone] Proxy Search Failed:",n),[]}}async hybridSearch(o,r="default",t={}){if(!this.pc)return[];const{topK:n=5,userInteractionCount:i=0}=t,e=t.alpha??Math.max(.3,.7-i*.02);try{const s=this.getIndex();if(!s)return[];const a=await p(o);if(!a)return[];const m=(await s.namespace(r).query({vector:a,topK:n*2,includeMetadata:!0})).matches||[];if(m.length===0)return[];const f=o.toLowerCase().split(/\s+/).filter(c=>c.length>2),u=m.map(c=>{const d=c.score||0;let h=0;const l=c.metadata||{},g=[l.text||"",l.name||"",l.cuisine||"",Array.isArray(l.tags)?l.tags.join(" "):l.tags||""].join(" ").toLowerCase();f.forEach(P=>{g.includes(P)&&(h+=1/f.length)});const w=e*h+(1-e)*d;return{...c,score:w,_semanticScore:d,_bm25Score:h}});return u.sort((c,d)=>(d.score||0)-(c.score||0)),console.log(`[Pinecone] Hybrid search (alpha=${e.toFixed(2)}): ${u.length} results`),u.slice(0,n)}catch(s){return console.error("[Pinecone] Hybrid Search Error:",s),[]}}isAvailable(){return this.isInitialized&&this.pc!==null}}const O=new I;export{O as pineconeService};
