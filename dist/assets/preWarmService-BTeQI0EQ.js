const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-J6Xxs6vu.js","assets/index-1Zneb5no.js","assets/vendor-ai-CPrgQTwB.js","assets/index-1kTZQrIe.css","assets/firebaseService-C9yZOPCO.js","assets/vendor-db-CpiILupR.js","assets/clock-pZb8NoLU.js","assets/zap-BcV8zEwV.js","assets/share-2-CI2VHR69.js","assets/arrow-left-Cj57b7l6.js","assets/SEO-BL8M3-1-.js","assets/pineconeService-sEl9xxIl.js","assets/knowledgeGraphService-DV8qVhbm.js"])))=>i.map(i=>d[i]);
import{_ as m}from"./index-1Zneb5no.js";import{knowledgeGraph as W}from"./knowledgeGraphService-DV8qVhbm.js";import"./vendor-ai-CPrgQTwB.js";import"./Dashboard-J6Xxs6vu.js";import"./firebaseService-C9yZOPCO.js";import"./vendor-db-CpiILupR.js";import"./clock-pZb8NoLU.js";import"./zap-BcV8zEwV.js";import"./share-2-CI2VHR69.js";import"./arrow-left-Cj57b7l6.js";import"./SEO-BL8M3-1-.js";const P=async()=>await m(()=>import("./Dashboard-J6Xxs6vu.js").then(l=>l.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),T=async()=>{const{personaService:l}=await m(async()=>{const{personaService:i}=await Promise.resolve().then(()=>A);return{personaService:i}},void 0);return l},S=async()=>{const{pineconeService:l}=await m(async()=>{const{pineconeService:i}=await import("./pineconeService-sEl9xxIl.js");return{pineconeService:i}},__vite__mapDeps([11,0,1,2,3,4,5,6,7,8,9,10]));return l},k=async()=>{const{knowledgeGraph:l}=await m(async()=>{const{knowledgeGraph:i}=await import("./knowledgeGraphService-DV8qVhbm.js");return{knowledgeGraph:i}},__vite__mapDeps([12,1,2,3,0,4,5,6,7,8,9,10]));return l};class ${constructor(){this.preWarmedDishes=new Map}async generateStreamingDishes(i,e,s,t){const{userId:r,isNewUser:n}=s,c=Date.now();try{const o=Date.now();let a=[];if(r&&this.preWarmedDishes.has(r)&&(a=(this.preWarmedDishes.get(r)||[]).splice(0,Math.min(3,i)),console.log(`[Streaming] Tier 1: Served ${a.length} pre-warmed dishes`)),a.length<3){const u=3-a.length,{getCachedDishes:p}=await P(),d=await p(u,e);a=[...a,...d]}a.length>0&&t({tier:1,dishes:a,latencyMs:Date.now()-o,source:"cache"})}catch(o){console.warn("[Streaming] Tier 1 failed:",o)}try{const o=Date.now();let a=[];if(n&&r){const d=await T(),{personaId:g}=await d.initializeNewUser(r,e),w=d.getSampleDishes(g),h=await S();for(const b of w.slice(0,3)){const y=await h.search(b,"dishes",1);if(y.length>0&&y[0].metadata){const f=y[0].metadata;f.name&&f.description&&a.push(f)}}}else{const d=await S(),g=`${e.cuisines.join(" ")} ${e.dietaryPreference} dishes`;a=(await d.search(g,"dishes",5)).filter(h=>h.score&&h.score>.8).map(h=>h.metadata).filter(h=>h&&h.name)}const{getCachedDishes:u}=await P(),p=new Set((await u(10,e)).map(d=>d.name));a=a.filter(d=>!p.has(d.name)),a.length>0&&t({tier:2,dishes:a.slice(0,i),latencyMs:Date.now()-o,source:"persona+vector"})}catch(o){console.warn("[Streaming] Tier 2 failed:",o)}console.log(`[Streaming] Tiers 1-2 complete in ${Date.now()-c}ms. Tier 3 ready.`)}setPreWarmedDishes(i,e){this.preWarmedDishes.set(i,e),console.log(`[Streaming] Stored ${e.length} pre-warmed dishes for user ${i}`)}hasPreWarmedDishes(i){const e=this.preWarmedDishes.get(i);return e!==void 0&&e.length>0}getPreWarmedCount(i){var e;return((e=this.preWarmedDishes.get(i))==null?void 0:e.length)||0}clearPreWarmedDishes(i){this.preWarmedDishes.delete(i)}async getInstantRecommendations(i,e=3){return(await(await k()).suggestDishes({dietaryPreference:i.dietaryPreference,allergens:i.allergens,cuisines:i.cuisines})).slice(0,e).map((n,c)=>({id:`instant-${Date.now()}-${c}`,name:n.displayName,localName:n.displayName,description:`Traditional ${n.cuisine} dish`,cuisine:n.cuisine,type:"Dinner",image:"",macros:{calories:300,protein:15,carbs:40,fat:10},ingredients:[],instructions:[],tags:n.dietaryTags,allergens:[],matchScore:80}))}}const v=new $,C={busy_professional:{id:"busy_professional",name:"Busy Professional",description:"Quick, healthy, minimal prep time. Values efficiency.",filters:{maxCookTime:30,difficulty:"easy"},preferences:{quick:1,healthy:.8,minimal_ingredients:.7},cuisineWeights:{Mediterranean:.9,Japanese:.8,Thai:.7},avoidPatterns:["elaborate","time-intensive","multiple-steps"],sampleDishes:["Avocado Toast","Quick Stir Fry","Salad Bowl","Grilled Sandwich"]},health_enthusiast:{id:"health_enthusiast",name:"Health Enthusiast",description:"Low GI, high protein, nutrient-dense. Tracks macros.",filters:{glycemicIndex:["Low","Medium"],nutritionFocus:"high-protein"},preferences:{healthy:1,protein_rich:.9,low_carb:.7},cuisineWeights:{Mediterranean:.9,Japanese:.8,"South Indian":.6},avoidPatterns:["fried","high-sugar","processed"],sampleDishes:["Grilled Chicken Salad","Quinoa Bowl","Steamed Fish","Lentil Soup"]},traditional_cook:{id:"traditional_cook",name:"Traditional Cook",description:"Authentic recipes, time-intensive, heritage cooking.",filters:{difficulty:"any",authentic:!0},preferences:{authentic:1,traditional:.9,homestyle:.8},cuisineWeights:{"North Indian":.9,"South Indian":.9,Bengali:.8},avoidPatterns:["fusion","shortcuts","instant"],sampleDishes:["Dum Biryani","Slow-Cooked Dal","Traditional Curry","Handmade Roti"]},spice_lover:{id:"spice_lover",name:"Spice Lover",description:"High heat, bold flavors, adventurous palate.",filters:{spiceLevel:"high"},preferences:{spicy:1,bold_flavors:.9,heat:.8},cuisineWeights:{Thai:.9,Mexican:.9,Andhra:.9,Szechuan:.8},avoidPatterns:["mild","bland","subtle"],sampleDishes:["Andhra Chicken","Thai Green Curry","Chettinad Masala","Szechuan Tofu"]},family_cook:{id:"family_cook",name:"Family Cook",description:"Kid-friendly, crowd-pleasing, balanced nutrition.",filters:{kidFriendly:!0,spiceLevel:"mild"},preferences:{family_friendly:1,mild:.8,nutritious:.7},cuisineWeights:{"North Indian":.8,Italian:.8,Continental:.7},avoidPatterns:["very-spicy","exotic","unusual-textures"],sampleDishes:["Paneer Butter Masala","Pasta","Fried Rice","Dal Tadka"]},experimental_foodie:{id:"experimental_foodie",name:"Experimental Foodie",description:"Fusion, unique ingredients, culinary adventure.",filters:{novelty:"high"},preferences:{unique:1,fusion:.9,creative:.8},cuisineWeights:{Fusion:.9,Korean:.8,"Middle Eastern":.8,Peruvian:.7},avoidPatterns:["basic","common","predictable"],sampleDishes:["Korean Tacos","Butter Chicken Pizza","Sushi Burrito","Masala Mac & Cheese"]},diabetic_friendly:{id:"diabetic_friendly",name:"Diabetic-Friendly",description:"Low GI, controlled portions, blood sugar safe.",filters:{glycemicIndex:["Low"],lowSugar:!0},preferences:{low_gi:1,controlled_portions:.9,fiber_rich:.8},cuisineWeights:{Mediterranean:.9,"South Indian":.7,Japanese:.8},avoidPatterns:["high-sugar","white-rice","refined-carbs","sweet"],sampleDishes:["Cauliflower Rice Bowl","Grilled Fish","Vegetable Stir Fry","Moong Dal Cheela"]},weight_management:{id:"weight_management",name:"Weight Management",description:"Low calorie, high satiety, portion-controlled.",filters:{maxCalories:500,highSatiety:!0},preferences:{low_calorie:1,high_satiety:.9,protein_rich:.8},cuisineWeights:{Mediterranean:.9,Japanese:.9,Thai:.7},avoidPatterns:["fried","high-fat","heavy-cream","dessert"],sampleDishes:["Grilled Chicken Breast","Vegetable Soup","Salad with Protein","Steamed Dumplings"]}},M={dietaryToPersona:{Vegan:["health_enthusiast","weight_management"],Vegetarian:["traditional_cook","health_enthusiast"],"Non-Vegetarian":["spice_lover","family_cook","busy_professional"]},conditionToPersona:{Diabetes:["diabetic_friendly"],PCOS:["diabetic_friendly","weight_management"],Hypertension:["health_enthusiast","weight_management"]},cuisineToPersona:{Thai:["spice_lover","experimental_foodie"],Japanese:["health_enthusiast","busy_professional"],"North Indian":["traditional_cook","family_cook","spice_lover"],"South Indian":["traditional_cook","diabetic_friendly"],Italian:["family_cook","busy_professional"],Mediterranean:["health_enthusiast","weight_management"]}},D={personas:C,mappingRules:M};class E{constructor(){this.personaEmbeddings=new Map,this.personas=D.personas,this.mappingRules=D.mappingRules}assignPersona(i){const e=Object.keys(this.personas).map(t=>({personaId:t,score:this.calculatePersonaScore(t,i)}));e.sort((t,r)=>r.score-t.score);const s=e[0];return console.log(`[PersonaService] Assigned persona: ${s.personaId} (score: ${s.score.toFixed(2)})`),s.personaId}calculatePersonaScore(i,e){let s=0;const t=this.personas[i];if(e.conditions.forEach(n=>{const c=n;(this.mappingRules.conditionToPersona[c]||[]).includes(i)&&(s+=3)}),(this.mappingRules.dietaryToPersona[e.dietaryPreference]||[]).includes(i)&&(s+=2),e.cuisines.forEach(n=>{(this.mappingRules.cuisineToPersona[n]||[]).includes(i)&&(s+=1),t.cuisineWeights[n]&&(s+=t.cuisineWeights[n]*.5)}),e.biometrics){const{goal:n,activityLevel:c}=e.biometrics;n==="Lose"&&i==="weight_management"&&(s+=2),c==="Active"&&i==="busy_professional"&&(s+=1),c==="Moderate"&&i==="health_enthusiast"&&(s+=.5)}return s}getPersona(i){return this.personas[i]||null}getAllPersonas(){return Object.values(this.personas)}async getPersonaEmbedding(i){if(this.personaEmbeddings.has(i))return this.personaEmbeddings.get(i);const e=this.personas[i];if(!e)return null;const s=[`User Persona: ${e.name}.`,e.description,`Prefers: ${Object.keys(e.preferences).join(", ")}.`,`Cuisines: ${Object.keys(e.cuisineWeights).join(", ")}.`,`Avoids: ${e.avoidPatterns.join(", ")}.`,`Sample dishes: ${e.sampleDishes.join(", ")}.`].join(" "),{generateEmbedding:t}=await m(async()=>{const{generateEmbedding:n}=await import("./Dashboard-J6Xxs6vu.js").then(c=>c.a);return{generateEmbedding:n}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),r=await t(s);return r&&this.personaEmbeddings.set(i,r),r}async initializeNewUser(i,e){try{const s=this.assignPersona(e),t=this.personas[s];if(!t)throw new Error(`Persona not found: ${s}`);const r=[`User Persona: ${t.name}.`,`Dietary: ${e.dietaryPreference}.`,`Cuisines: ${e.cuisines.join(", ")||"Various"}.`,`Health: ${e.conditions.length>0?e.conditions.join(", "):"None"}.`,`Allergens: ${e.allergens.length>0?e.allergens.join(", "):"None"}.`,t.description].join(" "),{pineconeService:n}=await m(async()=>{const{pineconeService:c}=await import("./pineconeService-sEl9xxIl.js");return{pineconeService:c}},__vite__mapDeps([11,0,1,2,3,4,5,6,7,8,9,10]));return await n.upsert([{id:`user_${i}_persona`,text:r,metadata:{type:"user_persona",userId:i,personaId:s,personaName:t.name,dietaryPreference:e.dietaryPreference,conditions:e.conditions,cuisines:e.cuisines,createdAt:Date.now()}}],"users"),console.log(`[PersonaService] Initialized user ${i} with persona: ${s}`),{personaId:s,success:!0}}catch(s){return console.error("[PersonaService] Failed to initialize user:",s),{personaId:"busy_professional",success:!1}}}getSampleDishes(i){const e=this.personas[i];return(e==null?void 0:e.sampleDishes)||[]}getCuisineWeights(i){const e=this.personas[i];return(e==null?void 0:e.cuisineWeights)||{}}getAvoidPatterns(i){const e=this.personas[i];return(e==null?void 0:e.avoidPatterns)||[]}}const _=new E,A=Object.freeze(Object.defineProperty({__proto__:null,personaService:_},Symbol.toStringTag,{value:"Module"}));class N{constructor(){this.preWarmStatus=new Map,this.preWarmQueue=new Set}async startPreWarming(i,e){if(this.preWarmQueue.has(i)){console.log(`[PreWarm] User ${i} already in queue, skipping.`);return}this.preWarmQueue.add(i),this.preWarmStatus.set(i,{userId:i,startedAt:Date.now(),completedAt:null,dishCount:0,status:"in_progress"}),console.log(`[PreWarm] Starting background generation for user ${i}...`);try{const s=_.assignPersona(e),t=_.getPersona(s);if(!t)throw new Error(`Persona not found: ${s}`);const r=W.suggestDishes({dietaryPreference:e.dietaryPreference,allergens:e.allergens,cuisines:e.cuisines}),n=[];for(const a of r.slice(0,8)){const u={id:`prewarm-kg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:a.displayName,localName:a.displayName,description:`Traditional ${a.cuisine} dish - ${e.dietaryPreference}`,cuisine:a.cuisine,type:this.inferMealType(a.displayName),image:"",macros:this.estimateMacros(a),ingredients:[],instructions:[],tags:a.dietaryTags,healthTags:this.generateHealthTags(e,a),allergens:[],matchScore:85+Math.floor(Math.random()*10),generatedAt:Date.now()};n.push(u)}const c=t.sampleDishes||[];for(const a of c.slice(0,4)){const u={id:`prewarm-persona-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:a,localName:a,description:`${t.name} style - ${t.description}`,cuisine:Object.keys(t.cuisineWeights)[0]||"Fusion",type:"Dinner",image:"",macros:{calories:350,protein:20,carbs:35,fat:12},ingredients:[],instructions:[],tags:Object.keys(t.preferences).map(p=>p.replace("_"," ")),healthTags:[],allergens:[],matchScore:90,generatedAt:Date.now()};n.push(u)}v.setPreWarmedDishes(i,n);const o=this.preWarmStatus.get(i);o&&(o.completedAt=Date.now(),o.dishCount=n.length,o.status="complete"),console.log(`[PreWarm] Complete for user ${i}: ${n.length} dishes in ${Date.now()-((o==null?void 0:o.startedAt)||Date.now())}ms`)}catch(s){console.error(`[PreWarm] Failed for user ${i}:`,s);const t=this.preWarmStatus.get(i);t&&(t.status="failed")}finally{this.preWarmQueue.delete(i)}}isPreWarmComplete(i){const e=this.preWarmStatus.get(i);return(e==null?void 0:e.status)==="complete"}getStatus(i){return this.preWarmStatus.get(i)||null}getPreWarmedDishes(i){return v.getPreWarmedCount(i)}inferMealType(i){const e=i.toLowerCase();return e.includes("breakfast")||e.includes("toast")||e.includes("paratha")||e.includes("poha")||e.includes("idli")||e.includes("dosa")?"Breakfast":e.includes("snack")||e.includes("pakora")||e.includes("chaat")||e.includes("samosa")?"Snack":e.includes("rice")||e.includes("thali")||e.includes("dal")?"Lunch":"Dinner"}estimateMacros(i){var s,t;const e={calories:300,protein:15,carbs:40,fat:10};return(s=i.dietaryTags)!=null&&s.includes("Vegetarian")&&(e.protein-=5),(t=i.dietaryTags)!=null&&t.includes("Non-Vegetarian")&&(e.protein+=10),e}generateHealthTags(i,e){const s=[];return i.conditions.includes("Diabetes")&&s.push("Diabetes-Friendly"),i.conditions.includes("PCOS")&&s.push("PCOS-Safe"),i.dietaryPreference==="Vegan"&&s.push("Plant-Based"),s}}const Q=new N;export{Q as preWarmService};
