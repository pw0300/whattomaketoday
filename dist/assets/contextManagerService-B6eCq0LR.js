const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-J6Xxs6vu.js","assets/index-1Zneb5no.js","assets/vendor-ai-CPrgQTwB.js","assets/index-1kTZQrIe.css","assets/firebaseService-C9yZOPCO.js","assets/vendor-db-CpiILupR.js","assets/clock-pZb8NoLU.js","assets/zap-BcV8zEwV.js","assets/share-2-CI2VHR69.js","assets/arrow-left-Cj57b7l6.js","assets/SEO-BL8M3-1-.js","assets/pineconeService-sEl9xxIl.js"])))=>i.map(i=>d[i]);
import{_ as u}from"./index-1Zneb5no.js";import{e as y}from"./Dashboard-J6Xxs6vu.js";import"./vendor-ai-CPrgQTwB.js";import"./firebaseService-C9yZOPCO.js";import"./vendor-db-CpiILupR.js";import"./clock-pZb8NoLU.js";import"./zap-BcV8zEwV.js";import"./share-2-CI2VHR69.js";import"./arrow-left-Cj57b7l6.js";import"./SEO-BL8M3-1-.js";class l{constructor(){this.currentSession=null,this.condensedMemory=null}initSession(t){this.currentSession={sessionId:`sess_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,startedAt:Date.now(),events:[],tokenEstimate:0},console.log(`[ContextManager] Session initialized: ${this.currentSession.sessionId}`);try{const e=localStorage.getItem("tadka_brain_memory");e&&(this.condensedMemory=JSON.parse(e),console.log("[ContextManager] AI Memory restored."))}catch(e){console.warn("[ContextManager] Failed to restore memory",e)}}recordEvent(t){var i;if(!this.currentSession)return;this.currentSession.events.push(t);let e=10;t.dish&&(e+=y(t.dish.name+(((i=t.dish.tags)==null?void 0:i.join(" "))||""))),t.query&&(e+=y(t.query)),this.currentSession.tokenEstimate+=e,console&&console.debug(`[ContextManager] Event: ${t.type}. Context size: ~${this.currentSession.tokenEstimate} tokens`)}setCondensedMemory(t){this.condensedMemory=t,localStorage.setItem("tadka_brain_memory",JSON.stringify(t))}getCondensedMemory(){return this.condensedMemory}getOptimizedContext(t="feed"){let e="";if(this.condensedMemory&&(e+=`USER PROFILE SUMMARY: ${this.condensedMemory.summary}
`,this.condensedMemory.avoidPatterns.length>0&&(e+=`KNOWN DISLIKES: ${this.condensedMemory.avoidPatterns.join(", ")}
`)),this.currentSession&&this.currentSession.events.length>0){const i=this.currentSession.events.slice(-10),a=i.filter(r=>r.type==="swipe_right"||r.type==="swipe_up").map(r=>{var s;return(s=r.dish)==null?void 0:s.name}).filter(Boolean),m=i.filter(r=>r.type==="swipe_left").map(r=>{var s;return(s=r.dish)==null?void 0:s.name}).filter(Boolean);a.length>0&&(e+=`JUST LIKED: ${a.join(", ")}
`),m.length>0&&(e+=`JUST SKIPPED: ${m.join(", ")}
`)}return e.trim()}async condenseSession(t){var e;if(!(!this.currentSession||this.currentSession.events.length===0))try{const i=this.currentSession.events.map(n=>{var o,d,c;return n.type==="swipe_right"?`Liked ${(o=n.dish)==null?void 0:o.name} (${(d=n.dish)==null?void 0:d.cuisine})`:n.type==="swipe_left"?`Disliked ${(c=n.dish)==null?void 0:c.name}`:n.type==="search"?`Searched "${n.query}"`:null}).filter(Boolean).join(". ");if(!i)return;const a=`Analyze this user session: "${i}". 
            Update their taste profile summary (approx 20 words). 
            Focus on flavor patterns, cuisines, and dislikes.
            Return JSON: { summary: "string", affinities: {"Cuisine": 0.0-1.0}, avoidPatterns: ["string"] }`,{secureGenerate:m}=await u(async()=>{const{secureGenerate:n}=await import("./Dashboard-J6Xxs6vu.js").then(o=>o.a);return{secureGenerate:n}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),s=await m(a,{type:6,properties:{summary:{type:1},affinities:{type:6},avoidPatterns:{type:4,items:{type:1}}}},"analyze");if(s&&s.summary){this.condensedMemory={userId:t,summary:s.summary,cuisineAffinities:s.affinities||{},avoidPatterns:s.avoidPatterns||[],lastCondensedAt:Date.now()},this.setCondensedMemory(this.condensedMemory),console.log(`[ContextManager] Memory Condensed: "${s.summary}"`);const{pineconeService:n}=await u(async()=>{const{pineconeService:o}=await import("./pineconeService-sEl9xxIl.js");return{pineconeService:o}},__vite__mapDeps([11,0,1,2,3,4,5,6,7,8,9,10]));await n.upsert([{id:`user_${t}_persona`,text:`User Persona: ${s.summary}. Likes: ${Object.keys(s.affinities||{}).join(", ")}. Avoids: ${(e=s.avoidPatterns)==null?void 0:e.join(", ")}`,metadata:{type:"user_persona",userId:t,raw_summary:s.summary}}])}}catch(i){console.error("[ContextManager] Condensation Failed:",i)}}}const k=new l;export{k as contextManager};
